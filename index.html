<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nebula Arcade</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.2/dist/umd/supabase.min.js"></script>
<style>
:root{
  --grad1:#ff8a00;--grad2:#ffd200;--text:#1b1f24;--border:#e5e7eb;
  --muted:#6b7280;--bg:#fff;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Inter,system-ui;background:var(--bg);color:var(--text);}
header{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 28px;border-bottom:1px solid var(--border);
  background:#fff;position:sticky;top:0;z-index:10;
}
.logo{font-family:"Fredoka One";font-size:22px;
background:linear-gradient(90deg,var(--grad1),var(--grad2));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.userMenu{position:relative;}
.userBtn{display:flex;align-items:center;gap:8px;padding:8px 14px;border-radius:12px;
background:linear-gradient(90deg,var(--grad1),var(--grad2));color:#2a2000;font-weight:700;
cursor:pointer;transition:.2s;}
.userBtn:hover{filter:brightness(1.05);}
.avatar{width:28px;height:28px;border-radius:50%;background:#fff;color:#2a2000;
display:flex;align-items:center;justify-content:center;font-family:"Fredoka One";}
.dropdown{
  position:absolute;right:0;top:110%;background:#fff;border:1px solid var(--border);
  border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.1);
  display:none;flex-direction:column;min-width:160px;overflow:hidden;
}
.dropdown button{
  background:none;border:0;text-align:left;padding:10px 16px;cursor:pointer;
  font-weight:600;color:var(--text);transition:.15s;
}
.dropdown button:hover{background:#f9f9f9;}
main{max-width:900px;margin:30px auto;padding:0 20px;}
.searchBox{margin-bottom:20px;display:flex;gap:10px;}
.searchBox input{
  flex:1;padding:12px;border:1px solid var(--border);border-radius:12px;font-size:15px;
}
.searchBox input:focus{border-color:#ffd24d;outline:none;box-shadow:0 0 0 4px #ffe08d60;}
.gamesGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;}
.gameCard{border:1px solid var(--border);border-radius:14px;background:#fff;
box-shadow:0 6px 18px rgba(0,0,0,.05);padding:12px;transition:.2s;cursor:pointer;}
.gameCard:hover{transform:translateY(-3px);}
.profileView{max-width:600px;margin:40px auto;text-align:center;}
.profileAvatar{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--grad1),var(--grad2));
display:flex;align-items:center;justify-content:center;color:#2a2000;font-family:"Fredoka One";font-size:36px;margin:0 auto 10px;}
.stats{display:flex;justify-content:center;gap:40px;margin:12px 0;color:var(--muted);}
.hidden{display:none;}
.wrapAuth{max-width:400px;margin:10vh auto;padding:24px;border:1px solid var(--border);
border-radius:16px;box-shadow:0 8px 26px rgba(0,0,0,.06);background:#fff;}
input{width:100%;padding:12px;margin:6px 0;border:1px solid var(--border);
border-radius:12px;font-size:15px}
input:focus{box-shadow:0 0 0 4px #ffe08d60;border-color:#ffd24d;outline:none}
.btn{border:0;border-radius:12px;padding:12px 20px;
font-weight:800;cursor:pointer;color:#2a2000;
background:linear-gradient(90deg,var(--grad1),var(--grad2));transition:.15s}
.btn:hover{background:linear-gradient(90deg,#ffa12b,#ffe04d);transform:translateY(-1px)}
.error{color:#b91c1c;font-size:14px;margin-top:6px;text-align:center}
.link{color:var(--muted);font-size:14px;text-decoration:underline;cursor:pointer;
text-align:center;display:block;margin-top:12px}
.gamePage{text-align:center;max-width:700px;margin:0 auto;}
.previewBox{width:100%;height:300px;background:#f3f3f3;border-radius:14px;
display:flex;align-items:center;justify-content:center;font-size:60px;}
.metaInfo{display:flex;justify-content:center;gap:20px;color:var(--muted);margin:10px 0;}
</style>
</head>
<body>
<header id="topbar" class="hidden">
  <div class="logo">Nebula Arcade</div>
  <div class="userMenu" id="userMenu">
    <div class="userBtn" id="userBtn">
      <div class="avatar" id="userAvatar">?</div>
      <span id="userNameTop">Cuenta</span>
    </div>
    <div class="dropdown" id="dropdown">
      <button id="viewProfileBtn">ğŸ‘¤ Ver perfil</button>
      <button id="logoutBtn">ğŸšª Cerrar sesiÃ³n</button>
      <button id="deleteBtn" style="color:#b91c1c;display:none;">ğŸ—‘ï¸ Eliminar cuenta</button>
    </div>
  </div>
</header>

<!-- LOGIN / REGISTRO -->
<div class="wrapAuth" id="authView">
  <h1 style="font-family:'Fredoka One';text-align:center;">Nebula Arcade</h1>
  <div id="loginForm">
    <input id="loginEmail" type="email" placeholder="Correo electrÃ³nico">
    <input id="loginPass" type="password" placeholder="ContraseÃ±a">
    <button id="loginBtn" class="btn" style="width:100%">Iniciar sesiÃ³n</button>
    <div id="loginError" class="error"></div>
    <span id="showSignup" class="link">Â¿No tienes cuenta? RegÃ­strate</span>
  </div>
  <div id="signupForm" class="hidden">
    <input id="nick" type="text" placeholder="Nombre o nickname">
    <input id="signupEmail" type="email" placeholder="Correo electrÃ³nico">
    <input id="signupPass" type="password" placeholder="ContraseÃ±a (mÃ­n. 6)">
    <button id="signupBtn" class="btn" style="width:100%">Registrarse</button>
    <div id="signupError" class="error"></div>
    <span id="showLogin" class="link">Â¿Ya tienes cuenta? Inicia sesiÃ³n</span>
  </div>
</div>

<!-- APP PRINCIPAL -->
<main id="appView" class="hidden">
  <div id="homeView">
    <div class="searchBox">
      <input id="searchInput" type="text" placeholder="Buscar juegos...">
    </div>
    <div class="gamesGrid" id="gamesGrid">
      <div class="gameCard" data-id="1" data-name="Ejemplo 1" data-desc="Primer juego de prueba" data-creator="Pablodev" data-likes="3" data-visits="10">ğŸ® Ejemplo 1</div>
      <div class="gameCard" data-id="2" data-name="Ejemplo 2" data-desc="Segundo juego de ejemplo" data-creator="LucÃ­a" data-likes="1" data-visits="4">ğŸ® Ejemplo 2</div>
      <div class="gameCard" data-id="3" data-name="Ejemplo 3" data-desc="Otro juego divertido" data-creator="Carlos" data-likes="7" data-visits="19">ğŸ® Ejemplo 3</div>
    </div>
  </div>

  <div id="profileView" class="hidden profileView">
    <div class="profileAvatar" id="profileAvatar">?</div>
    <h2 id="profileName">Usuario</h2>
    <div class="stats">
      <div>â¤ï¸ <span id="likesCount">0</span> Likes</div>
      <div>ğŸ‘ï¸ <span id="visitsCount">0</span> Visitas</div>
    </div>
    <h3>Juegos subidos</h3>
    <div class="gamesGrid" id="userGamesGrid">
      <div class="gameCard muted" style="text-align:center;">No has subido ningÃºn juego.</div>
    </div>
    <button id="backHomeBtn" class="btn" style="width:auto;margin-top:24px;">ğŸ  Volver al inicio</button>
  </div>

  <div id="gameView" class="hidden gamePage">
    <div class="previewBox" id="gamePreview">ğŸ®</div>
    <h2 id="gameTitle" style="margin-top:10px;">Nombre del juego</h2>
    <p id="gameDesc" style="margin:6px 0 12px;"></p>
    <div class="metaInfo">
      <span>â¤ï¸ <span id="likeCount">0</span></span>
      <span>ğŸ‘ï¸ <span id="visitCount">0</span></span>
    </div>
    <p>Creador: <span id="gameCreator" style="color:#ff8a00;font-weight:700;cursor:pointer;">Usuario</span></p>
    <div style="margin-top:20px;display:flex;justify-content:center;gap:12px;">
      <button id="likeBtn" class="btn">â¤ï¸ Like</button>
      <button id="dislikeBtn" class="btn" style="background:#ccc;color:#000;">ğŸ‘ Dislike</button>
      <button id="playBtn" class="btn">â–¶ï¸ Jugar</button>
    </div>
    <button id="backHomeFromGame" class="btn" style="margin-top:20px;">ğŸ  Volver</button>
  </div>
</main>

<script>
const SUPA_URL="https://arypwvzmjedlhsrzrgxw.supabase.co";
const SUPA_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeXB3dnptamVkbGhzcnpyZ3h3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxNzgwNDgsImV4cCI6MjA3NTc1NDA0OH0.oLuc_NKB2xh0-43clDOSP0ShISP9shjdrSJgd0jo0uY";
const supabase=window.supabase.createClient(SUPA_URL,SUPA_KEY);

const topbar=document.getElementById("topbar");
const authView=document.getElementById("authView");
const appView=document.getElementById("appView");
const homeView=document.getElementById("homeView");
const profileView=document.getElementById("profileView");
const gameView=document.getElementById("gameView");
const userMenu=document.getElementById("userMenu");
const userBtn=document.getElementById("userBtn");
const dropdown=document.getElementById("dropdown");
const userAvatar=document.getElementById("userAvatar");
const userNameTop=document.getElementById("userNameTop");
const deleteBtn=document.getElementById("deleteBtn");
const logoutBtn=document.getElementById("logoutBtn");
const viewProfileBtn=document.getElementById("viewProfileBtn");
const backHomeBtn=document.getElementById("backHomeBtn");
const backHomeFromGame=document.getElementById("backHomeFromGame");

let currentUser=null;

// Cambiar entre login y registro
showSignup.onclick=()=>{loginForm.classList.add("hidden");signupForm.classList.remove("hidden");};
showLogin.onclick=()=>{signupForm.classList.add("hidden");loginForm.classList.remove("hidden");};

// Registro
signupBtn.onclick=async()=>{
  const nickname=nick.value.trim(), email=signupEmail.value.trim(), pass=signupPass.value;
  signupError.textContent="";
  if(!nickname||!email||!pass){signupError.textContent="Completa todos los campos.";return;}
  const {error}=await supabase.auth.signUp({email,password:pass,options:{data:{nickname}}});
  if(error)signupError.textContent=error.message;else signupError.textContent="Cuenta creada correctamente.";
};

// Login
loginBtn.onclick=async()=>{
  const email=loginEmail.value.trim(), pass=loginPass.value;
  loginError.textContent="";
  const {error}=await supabase.auth.signInWithPassword({email,password:pass});
  if(error){loginError.textContent=error.message;return;}
  loadUser();
};

// Estado de sesiÃ³n
supabase.auth.onAuthStateChange((_e,session)=>{if(session)loadUser();else showAuth();});

// Cargar usuario
async function loadUser(){
  const {data:{user}}=await supabase.auth.getUser();
  if(!user){showAuth();return;}
  currentUser=user;
  const nick=user.user_metadata?.nickname||user.email;
  userAvatar.textContent=nick.charAt(0).toUpperCase();
  userNameTop.textContent=nick;
  deleteBtn.style.display=(nick.toLowerCase()==="pablodev")?"block":"none";
  showApp();
}

// Mostrar vistas
function showApp(){
  authView.classList.add("hidden");
  appView.classList.remove("hidden");
  topbar.classList.remove("hidden");
  homeView.classList.remove("hidden");
  profileView.classList.add("hidden");
  gameView.classList.add("hidden");
}
function showAuth(){
  authView.classList.remove("hidden");
  appView.classList.add("hidden");
  topbar.classList.add("hidden");
}

// Dropdown
userBtn.onclick=()=>dropdown.style.display=dropdown.style.display==="flex"?"none":"flex";
window.onclick=(e)=>{if(!userMenu.contains(e.target))dropdown.style.display="none";};

// Cerrar dropdown al hacer clic en opciÃ³n
function closeDropdown(){dropdown.style.display="none";}

// Perfil
viewProfileBtn.onclick=()=>{
  const nick=currentUser.user_metadata?.nickname||"Usuario";
  document.getElementById("profileAvatar").textContent=nick.charAt(0).toUpperCase();
  document.getElementById("profileName").textContent=nick;
  homeView.classList.add("hidden");
  profileView.classList.remove("hidden");
  gameView.classList.add("hidden");
  closeDropdown();
};
backHomeBtn.onclick=()=>{profileView.classList.add("hidden");homeView.classList.remove("hidden");};

// Logout
logoutBtn.onclick=async()=>{await supabase.auth.signOut();showAuth();closeDropdown();};

// Eliminar cuenta
deleteBtn.onclick=async()=>{
  if(confirm("Â¿Seguro que quieres eliminar tu cuenta y tus juegos?")) alert("SimulaciÃ³n: cuenta eliminada.");
  closeDropdown();
};

// NavegaciÃ³n a juego
document.querySelectorAll(".gameCard").forEach(card=>{
  card.onclick=()=>{
    const name=card.dataset.name,desc=card.dataset.desc,creator=card.dataset.creator;
    const likes=card.dataset.likes,visits=card.dataset.visits;
    homeView.classList.add("hidden");profileView.classList.add("hidden");
    gameView.classList.remove("hidden");
    gameTitle.textContent=name;
    gameDesc.textContent=desc;
    likeCount.textContent=likes;
    visitCount.textContent=visits;
    gameCreator.textContent=creator;
    gameCreator.onclick=()=>showProfile(creator);
  };
});

// Volver desde juego
backHomeFromGame.onclick=()=>{gameView.classList.add("hidden");homeView.classList.remove("hidden");};

// Mostrar perfil de otro
function showProfile(name){
  profileView.classList.remove("hidden");
  homeView.classList.add("hidden");
  gameView.classList.add("hidden");
  profileName.textContent=name;
  profileAvatar.textContent=name.charAt(0).toUpperCase();
  closeDropdown();
}
</script>
</body>
</html>
